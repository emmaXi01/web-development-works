{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/app.js","webpack:///./src/services.js"],"names":["login","document","querySelector","status","chatRoom","errMessages","appState","pollId","isLoggedIn","users","messages","error","renderPage","renderLogin","renderChatRoom","renderErrors","show","innerHTML","disabled","innerText","renderUsers","renderMessages","usersList","map","user","username","join","messageList","message","sender","timeStamp","text","addEventListener","event","target","classList","contains","addUser","value","fetchLogin","then","chat","Object","values","poll","err","errorCode","shouldPoll","setInterval","fetchMessage","clearTimeout","addMessage","fetchSendMessage","fetchLogout","fetch","method","headers","Headers","body","JSON","stringify","Promise","reject","response","ok","json","credentials"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/app.js\");\n","\"use strict\";\nimport {\n    fetchLogin,\n    fetchMessage,\n    fetchSendMessage,\n    fetchLogout,\n} from './services';\n\nconst login = document.querySelector('.login-panel');\nconst status = document.querySelector('.status');\nconst chatRoom = document.querySelector('.chat-panel');\n\n//error messages\nconst errMessages = {\n    'invalid-user': \"User not found, please login!\",\n    'invalid-username': \"Bad login, Please enter a valid user name without containing whitespace and 'dog'!\",\n    'network-error': \"There is a problem connecting to the network, try again!\",\n    'missing-text': \"The message content cannot be empty\",\n}\n\nconst appState = {\n    pollId: null,\n    isLoggedIn: false,\n    users:[],\n    messages:[],\n    error:'',\n}\n\nfunction renderPage() {\n    if(appState.isLoggedIn) {\n        renderLogin(false);\n        renderChatRoom(true);\n    } else {\n        renderLogin(true);\n        renderChatRoom(false);\n    }\n    renderErrors(appState.error);\n}\n\nfunction renderLogin(show) {  \n    if(show) {\n        login.innerHTML = `\n            <input class=\"user-name\" type=\"text\" placeholder=\"Enter a user name\" />\n            <button class=\"login-button\" type=\"button\">Sign in</button>\n        `;\n        login.querySelector('.login-button').disabled = true;\n    } else {\n        login.innerHTML=``;\n    }\n}\n\nfunction renderErrors(error) {\n    status.innerText = errMessages[error] || error;\n}\n\nfunction renderChatRoom(show) {\n    if(show) {\n        chatRoom.innerHTML = `\n            <h1 class=\"title\">Chat Room</h1>\n            <div class=\"logout\">\n                <button class=\"logout-button\" type=\"button\">Sign out</button>\n            </div>\n            <div class=\"display-panel\">\n                <div class=\"users-panel\">\n                    <h3 class=\"title\">Users</h3>\n                    <ul class=\"users\"></ul> \n                </div>\n                <div class=\"messages-panel\"> \n                    <h3 class=\"title\">Chat Messages</h3>  \n                    <ul class=\"messages\"></ul> \n                </div>   \n            </div>\n            <div class=\"outgoing\">\n                <div>\n                    <label>Message: </label>\n                    <input class=\"to-add-message\" type=\"text\" placeholder=\"Enter a message\" />\n                    <button class=\"send-button\" type=\"button\">Send</button>\n                </div>\n            </div> \n        `;\n\n        chatRoom.querySelector('.send-button').disabled = true;\n        renderUsers(appState.users);\n        renderMessages(appState.messages);\n    } else {\n        chatRoom.innerHTML = ``;\n    } \n}\n\nfunction renderUsers(users) {\n    const usersList = chatRoom.querySelector('.users'); \n    usersList.innerHTML = users.map( (user) => `<li class=\"user\"> ${user.username}</li>`).join('');\n}\n\nfunction renderMessages(messages) {\n    const messageList = chatRoom.querySelector('.messages');\n    messageList.innerHTML = messages.map( (message) => {\n        return `\n            <li class=\"message-info\">\n                <div class=\"meta-info\">\n                    <span class=\"sender\">${message.sender}</span>\n                    <span class=\"timestamp\">${message.timeStamp}</span>\n                </div>\n                <div class=\"text-info\">\n                    <span class=\"message-text\">${message.text}</span>\n                </div>\n            </li>\n            `;\n    }).join(' ');\n}\n\n\n//login\nlogin.addEventListener('click', (event) => {\n    if(!event.target.classList.contains('login-button')) {\n        return;\n    }\n\n    const addUser = login.querySelector('.user-name');\n    const username = addUser.value;\n    addUser.value = '';\n\n    fetchLogin(username)\n    .then( (chat) => {\n        appState.isLoggedIn = true;\n        appState.users = Object.values(chat.users);\n        appState.messages = chat.messages;\n        appState.error = '';\n        renderPage();\n        poll(true);\n    })\n    .catch( (err) => {\n        appState.error = err.errorCode;\n        renderPage();\n    });   \n});\n\n//get username\nlogin.addEventListener('keyup', (event) => {\n    if(!event.target.classList.contains('user-name')) {\n        return;\n    }\n    \n    const text = event.target.value;\n    login.querySelector('.login-button').disabled = !text;\n});\n\n\n//polling\nfunction poll(shouldPoll) {\n    if(shouldPoll && !appState.pollId) {\n        appState.pollId = setInterval( () => {\n            fetchMessage()\n            .then( (chat) => {\n                appState.users = Object.values(chat.users);\n                appState.messages = chat.messages;\n                appState.error = '';\n                renderUsers(appState.users);\n                renderMessages(appState.messages);\n            })\n            .catch( (err) => {\n                if(err.errorCode === 'invalid-user') {\n                    appState.isLoggedIn = false;\n                    appState.error = '';\n                    renderPage();\n                    poll(false);\n                    return;\n                }\n\n                appState.error = err.errorCode;\n                renderErrors(appState.error);\n            });\n        }, 3000);\n    }\n    \n    //when a user lohout\n    if(!shouldPoll && appState.pollId) {\n        clearTimeout(appState.pollId);\n        appState.pollId = null;\n    }\n}\n\n\n//send message\nchatRoom.addEventListener('click', (event) => {\n    if(!event.target.classList.contains('send-button')) {\n        return;\n    }\n    \n    const addMessage = chatRoom.querySelector('.to-add-message');\n    const text = addMessage.value;\n    addMessage.value = '';\n\n    fetchSendMessage(text)\n    .then( (messages) => {\n        appState.messages = messages;\n        renderPage();\n    })\n    .catch( (err) => {\n        appState.error = err.errorCode;\n        renderPage();\n    });\n});\n\n//get message\nchatRoom.addEventListener('keyup', (event) => {\n    if(!event.target.classList.contains('to-add-message')) {\n        return;\n    }\n\n    const text = event.target.value;\n    chatRoom.querySelector('.send-button').disabled = !text;\n});\n\n\n//logout\nchatRoom.addEventListener('click', (event) => {\n    if(!event.target.classList.contains('logout-button')) {\n        return;\n    }\n\n    fetchLogout()\n    .then( () => {\n        appState.isLoggedIn = false;\n        appState.users = [];\n        appState.message = [];\n        appState.error = '';\n        poll(false);\n        renderPage();  \n    })\n    .catch( (err) => {\n        appState.error = err.errorCode;   \n        poll(false);\n        renderPage();\n    })\n});\n\n\n//initial load\nfetchMessage()\n.then( (chat) => {\n    appState.users = Object.values(chat.users);\n    appState.messages = chat.messages;\n    appState.error = '';\n    appState.isLoggedIn = true;\n    renderPage();\n    poll(true);\n})\n.catch( (err) => {\n    appState.isLoggedIn = false;\n    poll(false);\n    renderPage();\n});\n\n\n\n\n\n\n","\"use strict\";\nexport const fetchLogin = (username) => {\n    return fetch('/session', {\n        method: 'POST',\n        headers: new Headers({\n            'content-type': 'application/json'\n        }),\n        body: JSON.stringify({ username }),\n    })\n    .catch( () => Promise.reject({ errorCode: 'network-error'}) )\n    . then( (response) => {\n        if(!response.ok) {\n            return response.json().then( err => Promise.reject(err) );\n        }\n        return response.json();\n    });\n};\n\nexport const fetchMessage = () => {\n    return fetch('/chat', {\n        method: 'GET',\n    })\n    .catch( () => Promise.reject({ errorCode: 'network-error'}) )\n    .then( (response) => {\n        if(!response.ok) {\n            return response.json().then( (err) => Promise.reject(err) );\n        }\n        return response.json();\n    });\n};\n\nexport const fetchSendMessage = (text) => {\n    return fetch('/chat', {\n        method: 'POST',\n        headers: new Headers({\n            'content-type': 'application/json'\n        }),\n        body: JSON.stringify({ text }),\n        credentials: 'include',\n    })\n    .catch( () => Promise.reject({ errorCode: 'network-error' }) )\n    .then( (response) => {\n        if(!response.ok) {\n            return response.json().then( (err) => Promise.reject(err) )\n        }\n        return response.json();\n    });\n};\n\nexport const fetchLogout = () => {\n    return fetch('/session', {\n        method: 'DELETE',\n        headers: new Headers({\n            'content-type': 'application/json'\n        })\n    })\n    .catch( () => Promise.reject({errorCode: 'network-error'}) )\n    .then( (response) => {\n        if(!response.ok) {\n            return response.json().then( (err) => Promise.reject(err) )\n        }\n        return;\n    });\n};\n"],"sourceRoot":""}